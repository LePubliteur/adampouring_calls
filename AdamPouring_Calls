import os
import telebot

bot = telebot.TeleBot(os.environ.get("TELEGRAM_API_KEY"))

# Keyboard buttons
call = telebot.types.KeyboardButton('Call üìû')
cancel = telebot.types.KeyboardButton('Cancel ‚ùå')

# Reply keyboard 
keyboard = telebot.types.ReplyKeyboardMarkup(row_width=2)
keyboard.row(call, cancel)

# Helper function to generate call summary 
def generate_call_summary():
    return f"Call connected for 5 minutes. \nCaller: {caller_name} \nCallee: {callee_name}"  

# Start command 
@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, 'Welcome! What would you like to do?', reply_markup=keyboard)

# Call handler 
@bot.message_handler(func=lambda message: message.text == 'Call üìû')  
def call(message):
    bot.send_message(message.chat.id, "Please provide the caller and callee names.")

# Caller name handler 
@bot.message_handler(func=lambda message: True)  
def caller_name(message):
    global caller_name
    caller_name = message.text
    
    bot.send_message(message.chat.id, "Please provide the callee name.")

# Callee name handler
@bot.message_handler(func=lambda message: True) 
def callee_name(message):
    global callee_name 
    callee_name = message.text
    
    summary = generate_call_summary()
    bot.send_message(message.chat.id, summary) 
    
# Cancel handler
@bot.message_handler(func=lambda message: message.text == '‚ùå Cancel')  
def cancel(message):
    bot.send_message(message.chat.id, "Action cancelled.")  

bot.polling()
